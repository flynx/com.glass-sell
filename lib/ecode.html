<!doctype html>
<html>
<head>
<meta charset="UTF-8">
<style>

/* errors... */
#fields .error {
	color: red;
}

/* emphesize the first col... */
#fields td:first-child {
	font-weight: bold;
}


/* the demo ecode with part indicators... */
.ecode-demo {
	display: inline-block;
	position: relative;
	width: auto;
	cursor: pointer;
}
.ecode-demo .part:hover {
	color: white;
	background-color: gray;
}
.ecode-demo .part:hover:before {
	content: "";
	position: absolute;

	height: 10%;
	width: 110%;
	top: -10%;

	margin-left: 3pt;

	border-left: solid 1px gray;
	border-top: solid 1px gray;
}
.ecode-demo .part:hover:after {
	content: attr(value);

	display: inline;
	position: absolute;

	min-width: 110%;
	width: auto;
	height: auto;
	left: 110%;
	top: -10%;

	padding-left: 2pt;
	padding-top: 1pt;

	border-left: solid 5px gray;
	color: rgba(0, 0, 0, 0.5);
	background-color: white;
}

</style>

<script src="../public/js/jquery-1.11.3.min.js"></script>
<script src="ecode.js"></script>
<script>

function getEcode(){
	return $('#ecode').val().trim()
}

function clearField(){
	$('#fields').empty()
}


// XXX might be a good idea to make this into an ecode iterator...
function showECodeFields(ecode){
	var ecode = ecode || ecode2obj(getEcode())
	
	var fields = $('#fields')

	// report a parse error...
	if(ecode.error){
		$('<div class="error">')
			.text(ecode.error + '('+ ecode.failed +')')
			.appendTo(fields)

	// show the parsed result...
	} else {
		var table = $('<table>')
			.appendTo(fields)

		for(var k in ecode){
			var val = ecode[k]
			if(val == null || val.length == 0){
				continue
			}
			val = val[0].constructor === Array ? val : [val]

			val.forEach(function(val){
				$('<tr>')
					.append($('<td>').text(k))
					.append($('<td>')
						.text(val.constructor === Array ? 
							(val[1] || val[0]) + (val[1] ? ' ('+val[0]+')' : '')
							: val))
					.appendTo(table)
			})
		}
	}
}

function showEcodeDemo(ecode){
	var ecode = ecode || ecode2obj(getEcode())
	
	var fields = $('#fields')

	// report a parse error...
	if(ecode.error){
		$('<div class="error">')
			.text(ecode.error + '('+ ecode.failed +')')
			.appendTo(fields)

	// show the parsed result...
	} else {
		var demo = $('<div class="ecode-demo">')
			.appendTo(fields)
		
		for(var k in ecode){
			var val = ecode[k]
			if(val == null || val.length == 0){
				continue
			}
			val = val[0].constructor === Array ? val : [val]

			val.forEach(function(val){
				if(k != 'ecode'){
					$('<span class="part">')
							.text(val.constructor === Array ?  (val[1] ? val[0] : val) : val)
							.attr('value', val.constructor === Array ?  val[1] || k : k)
						.appendTo(demo)
				}
			})
		}
	}
}


function show(){
	var ecode = getEcode()
	if(ecode != ''){
		clearField()
		showECodeFields()
		showEcodeDemo()
	}
}


</script>
</head>
<body>

<h1>ECode parser</h1>
<input id="ecode" type="text" list="ecodes" oninput="show()">
<datalist id="ecodes">
	<option value="2031BGNHA1J">
	<option value="2037LGSH3FDW">
	<option value="2037AGSGY">
</datalist>
<!--button onclick="show()">parse</button-->

<div id="fields">
</div>




</body>
</html>
<!-- vim:set ts=4 sw=4 : -->
